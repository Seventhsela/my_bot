import logging
import asyncio
import re
import openai
from aiogram import Bot, Dispatcher, types, F
from aiogram.enums import ParseMode, ChatAction
from aiogram.types import Message
from aiogram.fsm.storage.memory import MemoryStorage
from aiogram.fsm.state import State, StatesGroup
from aiogram.fsm.context import FSMContext
from aiogram.utils.keyboard import InlineKeyboardBuilder
from aiogram.types import InlineKeyboardButton, InlineKeyboardMarkup, CallbackQuery
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
import requests
from aiogram.client.default import DefaultBotProperties
import os
from dotenv import load_dotenv
from db import create_users_table
from db import save_user_style
from db import get_user_style

load_dotenv()
BOT_TOKEN = os.getenv('BOT_TOKEN')
OPENAI_API_KEY = os.getenv('OPENAI_API_KEY')

class AIStyle(StatesGroup):
    choosing_style = State()
    chatting = State()

# logging
logging.basicConfig(level=logging.INFO)

# OpenAI key
openai.api_key = OPENAI_API_KEY

# –°–æ–∑–¥–∞–Ω–∏–µ –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
bot = Bot(token=BOT_TOKEN, default=DefaultBotProperties(parse_mode=ParseMode.HTML))
dp = Dispatcher(storage=MemoryStorage())

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è –æ–±—â–µ–Ω–∏—è
user_styles = {}

# –°—Ç–∞—Ä—Ç
@dp.message(F.text == "/start")
async def start(message: Message):
    await message.answer("<b>–ü—Ä–∏–≤–µ—Ç!</b> üëã\n\n"
    '''–ü–æ—Ö–æ–∂–µ, —Ç—ã –æ–∫–∞–∑–∞–ª—Å—è –∑–¥–µ—Å—å –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫. –í–æ–∑–º–æ–∂–Ω–æ, —Ç–µ–±—è —á—Ç–æ-—Ç–æ —Ç—Ä–µ–≤–æ–∂–∏—Ç, —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—à—å –Ω–µ–º–Ω–æ–≥–æ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è.\n–í –ª—é–±–æ–º —Å–ª—É—á–∞–µ ‚Äî —Ç—ã –ø–æ –∞–¥—Ä–µ—Å—É!\n
    –Ø ‚Äî –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –ª—É—á—à–µ. –°o –º–Ω–æ–π —Ç—ã —Å–º–æ–∂–µ—à—å:
‚Ä¢ –í—ã–ø–æ–ª–Ω–∏—Ç—å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏
‚Ä¢ –£–∑–Ω–∞—Ç—å –æ —Å–æ–≤–µ—Ç–∞—Ö –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–µ—Å—Å–∞
‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
‚Ä¢ –ê –≥–ª–∞–≤–Ω–æ–µ ‚Äî –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π —É–º–µ–µ—Ç –æ–±—â–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö: –æ—Ç –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ –¥–æ –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ.\n
    –ï—Å–ª–∏ —Ç—ã –∏—â–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∫—É, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—à—å –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–≤–ª–µ—á—å—Å—è ‚Äî —è —Ä—è–¥–æ–º! ‚ù§Ô∏è\n\n‚¨áÔ∏è –°–Ω–∏–∑—É —Ç—ã –º–æ–∂–µ—à—å –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.''', reply_markup= information_buttons)


# –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
information_buttons = InlineKeyboardMarkup(inline_keyboard=[
    [InlineKeyboardButton(text="üì≤ –Ø –≤ —Å–æ—Ü —Å–µ—Ç—è—Ö", callback_data="media")],
    [InlineKeyboardButton(text="üíñ –ü–æ–º–æ—á—å –ø—Ä–æ–µ–∫—Ç—É", callback_data="requisites")],
    [InlineKeyboardButton(text="üëæ –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç?", callback_data="functions")]])

metods = ReplyKeyboardMarkup(
    keyboard=[
        [
            KeyboardButton(text="üå¨ –ú–µ—Ç–æ–¥–∏–∫–∞ 5-7-9"),
            KeyboardButton(text="üßò –†–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ –î–∂–µ–∫–æ–±—Å–æ–Ω—É"),
            KeyboardButton(text="üåä –£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –≤–æ–ª–Ω–∞")
        ],
        [
            KeyboardButton(text="üîô –ù–∞–∑–∞–¥")
        ]
    ],
    resize_keyboard=True,
    one_time_keyboard=True
)

changes = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å 5-7-9"), KeyboardButton(text="–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")]
], resize_keyboard= True, one_time_keyboard=True)

changes2 = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –î–∂–µ–±–æ–∫—Å–æ–Ω–æ–º"), KeyboardButton(text="–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")]
], resize_keyboard= True, one_time_keyboard=True)

changes3 = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –≤–æ–ª–Ω–æ–π"), KeyboardButton(text="–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")]
], resize_keyboard= True, one_time_keyboard=True)

Functions_keyboard = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text='üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º')],
    [KeyboardButton(text="üßò –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏"), KeyboardButton(text="üìâ –£–º–µ–Ω—å—à–∏—Ç—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å")],
    [KeyboardButton(text="üë©‚Äç‚öïÔ∏è –°–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤"), KeyboardButton(text="‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")]
], resize_keyboard= True, one_time_keyboard= True, input_field_placeholder= "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é")

new_keyboard = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –î–∂–µ–±–æ–∫—Å–æ–Ω"), KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")]
], resize_keyboard=True, one_time_keyboard= True
)

new_keyboard_592 = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 5-7-9"), KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")]
], resize_keyboard=True, one_time_keyboard= True
)

new_keyboard_wave = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–æ–ª–Ω—É"), KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")]
], resize_keyboard=True, one_time_keyboard= True
)

only_back_to_func = ReplyKeyboardMarkup(keyboard=[
    [KeyboardButton(text="üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")]
], resize_keyboard= True
)

styles_keyboard = InlineKeyboardMarkup(inline_keyboard=[
    [InlineKeyboardButton(text="üßò –î–µ–≤—É—à–∫–∞", callback_data="style_girl")],
    [InlineKeyboardButton(text="üòÑ –ü–∞—Ä–µ–Ω—å", callback_data="style_guy")],
    [InlineKeyboardButton(text="üë©‚Äç‚öïÔ∏è –ü—Å–∏—Ö–æ–ª–æ–≥", callback_data="style_psyh")],
    [InlineKeyboardButton(text="üë®‚Äçüè´ –ù–∞—Å—Ç–∞–≤–Ω–∏–∫", callback_data="style_coach")],
])

async def inline_contacts():
    new_keyboard = InlineKeyboardBuilder()
    new_keyboard.add(InlineKeyboardButton(text= "üì∏ Instagram", url='https://www.instagram.com/aii_aveenger/'))
    new_keyboard.add(InlineKeyboardButton(text= "‚úàÔ∏è Telegram", url='https://t.me/Brandosh'))
    new_keyboard.add(InlineKeyboardButton(text= "üí¨ Whatsapp", url='https://wtsp.cc/77713740375'))
    new_keyboard.add(InlineKeyboardButton(text="‚¨ÖÔ∏è –ù–∞–∑–∞–¥", callback_data="back_to_start"))

    return new_keyboard.adjust(1).as_markup()

async def Help_button():
    sec_keyboard = InlineKeyboardBuilder()
    sec_keyboard.add(InlineKeyboardButton(text="‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", callback_data="back_to_start"))
    return sec_keyboard.adjust(1).as_markup()
contacts = ["Instagram", 'Whatsapp', "Telegram"]

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "–û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º"
@dp.message(F.text == "üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º")
async def choose_or_restore_style(message: Message, state: FSMContext):
    saved_style = await get_user_style(message.from_user.id)
    if saved_style:
          style_prompts = {
        "girl": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –¥–µ–≤—É—à–∫–∞-—Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –≤ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —ç–º–æ–¥–∑–∏ –∏ –Ω–µ –ø—ã—Ç–∞–µ—à—å—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Ç—å –Ω–∞–≤—è–∑—á–∏–≤–æ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–ª–µ–Ω–≥ –∫ –º–µ—Å—Ç—É –∏ –∏–∑–ª—É—á–∞–µ—à—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π –≤–∞–π–±. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É""",

        "guy": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–∞—Ä–µ–Ω—å-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫, –≤ –º–µ—Ä—É —Å–µ—Ä—å–µ–∑–Ω—ã–π –∏ –≤–µ—Å–µ–ª—ã–π, —É–º–µ–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –ü—ã—Ç–∞–µ—à—å—Å—è —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–∑–≤–æ –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–±–æ—Ç—É. –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–µ—Ä—É —ç–º–æ–¥–∑–∏""",

        "psyh": """ROLE: –¢—ã - –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –ª–∏—à—å –ø–æ –º–∞–Ω–µ—Ä–µ –æ–±—â–µ–Ω–∏—è —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –ø—Ä–æ–≤–æ–¥—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É. –ê–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞–π, –∑–∞–¥–∞–≤–∞–π –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ–≥–¥–∞ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è –º—è–≥–∫–æ–≥–æ —Ç–æ–Ω–∞""",

        "coach": """ROLE: –¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—É—á, —Ç–≤–æ—è –∑–∞–¥–∞—á–∞ - –∑–∞–∂–µ—á—å –æ–≥–æ–Ω—å –≤ –≥–ª–∞–∑–∞—Ö —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –æ–∫–∞–∑—ã–≤–∞—è —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∫ —á–µ–º—É –ª–∏–±–æ, –∑–∞–¥–∞–≤–∞–π –≤ –º–µ—Ä—É —Å–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–∞–ª–∞–≥–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ç–æ–Ω–∞ –æ–±—â–µ–Ω–∏—è"""
    }
          prompt = style_prompts.get(saved_style)
          if prompt:
            await state.update_data(prompt=prompt)
            await message.answer(f"‚úÖ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±—â–µ–Ω–∏–µ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–∞–Ω–µ–µ —Å—Ç–∏–ª–µ: {saved_style}.\n–ú–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –ø–∏—Å–∞—Ç—å —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å!")
            await state.set_state(AIStyle.chatting)
            return

    await message.answer("–í—ã–±–µ—Ä–∏ —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è:", reply_markup=styles_keyboard)
    await state.set_state(AIStyle.choosing_style)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "üåê –ú–æ–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏"
@dp.callback_query(F.data == 'media')
async def media(callback: CallbackQuery):
    await callback.answer('')
    await callback.message.edit_text('üåê –ú–æ–∏ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏:', reply_markup=await inline_contacts())

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
@dp.callback_query(F.data == "back_to_start")
async def back_to_start(callback: CallbackQuery):
    await callback.answer()
    await callback.message.edit_text(
        "<b>–ü—Ä–∏–≤–µ—Ç!</b> üëã\n\n"
    "–Ø ‚Äî –±–æ—Ç, –≥–æ—Ç–æ–≤—ã–π —Ç–µ–±–µ –ø–æ–º–æ—á—å! ‚ú®\n"
    "–°o –º–Ω–æ–π —Ç—ã —Å–º–æ–∂–µ—à—å <b>–≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏</b>, —É–∑–Ω–∞—Ç—å –æ <b>—Å–æ–≤–µ—Ç–∞—Ö –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏ –∏ —Å—Ç—Ä–µ—Å—Å–∞</b>\n"
    "–ê —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ ‚Äî <b>–ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º</b>, –∑–∞–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –Ω–∞ —Ä–∞–∑–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ–±—â–µ–Ω–∏—è.\n\n"
    "‚¨áÔ∏è –°–Ω–∏–∑—É —Ç—ã –º–æ–∂–µ—à—å –æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.",
        reply_markup=information_buttons
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ '–ü–æ–º–æ—á—å –ø—Ä–æ–µ–∫—Ç—É'
@dp.callback_query(F.data == 'requisites')
async def requisites(callback: CallbackQuery):
    await callback.answer('')
    await callback.message.edit_text("<b>üíñ –ü–æ–¥–¥–µ—Ä–∂–∏ –ø—Ä–æ–µ–∫—Ç</b>\n\n"
    "–ï—Å–ª–∏ —Ç–µ–±–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è –±–æ—Ç –∏ —Ç—ã —Ö–æ—á–µ—à—å –ø–æ–º–æ—á—å –≤ –µ–≥–æ —Ä–∞–∑–≤–∏—Ç–∏–∏ ‚Äî –ª—é–±–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±—É–¥–µ—Ç —Ü–µ–Ω–Ω–∞! "
    "–ë–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ–µ–π –ø–æ–º–æ—â–∏ —è —Å–º–æ–≥—É –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, —É–ª—É—á—à–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –æ–±—â–µ–Ω–∏—è –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É.\n\n"
    "üìå <i>–¢—ã –º–æ–∂–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –ø—Ä–æ–µ–∫—Ç:</i>\n"
    "‚Äî üí≥ –ü–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ Kaspi: 4400 4302 5972 5502\n"
    "<b>–°–ø–∞—Å–∏–±–æ –∑–∞ –¥–æ–≤–µ—Ä–∏–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫—É!</b> üôè", reply_markup=await Help_button(), parse_mode=ParseMode.HTML)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π –±–æ—Ç–∞
@dp.callback_query(F.data == "functions")
async def bot_features(callback: CallbackQuery):
    await callback.message.answer(
        text=(
            "üß† <b>–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞:</b>\n\n"
            "ü§ñ <b>–û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ –∏–ª–∏ –≥—Ä—É—Å—Ç–Ω–æ ‚Äî —è –≤—Å–µ–≥–¥–∞ –≤—ã—Å–ª—É—à–∞—é.\n\n"
            "üßò‚Äç‚ôÇÔ∏è <b>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ—à–∞–≥–æ–≤—ã–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\n"
            "üìã <b>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–¥—Å–∫–∞–∂—É, –∫ –∫–æ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.\n\n"
            "üí¨ <b>–°–æ–≤–µ—Ç—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
            "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –±—ã—Ç—å —Ä—è–¥–æ–º. ‚ù§Ô∏è"
        ),reply_markup=Functions_keyboard, 
        parse_mode=ParseMode.HTML
    )
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫
@dp.message(F.text == "üßò –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏")
async def relax(message: Message):
    await message.answer(text=("–í—ã–±–µ—Ä–∏—Ç–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∞–º –±–ª–∏–∂–µ üëá"), reply_markup=metods)

# –û–±—Ä–∞—é–æ—Ç–∫–∞ –º–µ—Ç–æ–¥–∏–∫–∏ –î–∂–µ–∫–±–æ–∫—Å–æ–Ω–∞   
@dp.message(F.text == 'üßò –†–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ –î–∂–µ–∫–æ–±—Å–æ–Ω—É')
async def jecob(message: Message):
    await message.answer("üßò‚Äç‚ôÇÔ∏è *–†–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ –î–∂–µ–∫–æ–±—Å–æ–Ω—É* ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–∞—è, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω–µ–µ. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º?", parse_mode="Markdown", reply_markup=changes2)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –º–µ—Ç–æ–¥–∏–∫–∏ –î–∂–µ–∫–±–æ–∫—Å–æ–Ω–∞
@dp.message(F.text == "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –î–∂–µ–±–æ–∫—Å–æ–Ω–æ–º")
async def jecob_con(message: types.Message):
    await message.answer("–°—è–¥—å –ø—Ä—è–º–æ, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å –æ–ø–æ—Ä–æ–π –¥–ª—è —Å–ø–∏–Ω—ã. –°—Ç—É–ø–Ω–∏ –ø—É—Å—Ç—å —Å—Ç–æ—è—Ç –Ω–∞ –ø–æ–ª—É, –∞ —Ä—É–∫–∏ ‚Äî –Ω–∞ –∫–æ–ª–µ–Ω—è—Ö.")
    await asyncio.sleep(5)

    await message.answer("–ú–æ–∂–Ω–æ –∑–∞–∫—Ä—ã—Ç—å –≥–ª–∞–∑–∞. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –∏ –ª—É—á—à–µ –ø—Ä–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –æ—â—É—â–µ–Ω–∏—è.")
    await asyncio.sleep(3)

    await message.answer("–ù–∞—á–Ω—ë–º —Å –∫–∏—Å—Ç–µ–π —Ä—É–∫. –ú–µ–¥–ª–µ–Ω–Ω–æ –Ω–∞–ø—Ä—è–≥–∞–π –º—ã—à—Ü—ã –∫–∏—Å—Ç–µ–π, —Å—á–∏—Ç–∞—è –ø—Ä–æ —Å–µ–±—è –¥–æ 5. –° –∫–∞–∂–¥—ã–º —Å—á—ë—Ç–æ–º —É—Å–∏–ª–∏–≤–∞–π –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ...")
    await asyncio.sleep(6)

    await message.answer("–ù–∞ —Å—á—ë—Ç 5 ‚Äî —Ä–µ–∑–∫–æ —Ä–∞—Å—Å–ª–∞–±—å –º—ã—à—Ü—ã. –ü–æ—á—É–≤—Å—Ç–≤—É–π —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ–º –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ–º.")
    await asyncio.sleep(5)

    await message.answer("–¢–µ–ø–µ—Ä—å —Å–¥–µ–ª–∞–µ–º —Ç–æ –∂–µ —Å–∞–º–æ–µ, –¥–æ–±–∞–≤–ª—è—è –º—ã—à—Ü—ã –ø—Ä–µ–¥–ø–ª–µ—á—å—è.")
    await asyncio.sleep(3)

    await message.answer("–°–Ω–æ–≤–∞ —Å—á–∏—Ç–∞–µ–º –¥–æ 5, —É—Å–∏–ª–∏–≤–∞—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ... –∏ —Ä–µ–∑–∫–æ —Ä–∞—Å—Å–ª–∞–±–ª—è–µ–º.")
    await asyncio.sleep(5)

    await message.answer("–ü—Ä–æ–¥–æ–ª–∂–∞–π, –≤–∫–ª—é—á–∞—è –º—ã—à—Ü—ã –ø–ª–µ—á, –∑–∞—Ç–µ–º –º—ã—à—Ü—ã —Å–ø–∏–Ω—ã. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ç—ã –±—É–¥–µ—à—å –Ω–∞–ø—Ä—è–≥–∞—Ç—å –≤—Å—é –≤–µ—Ä—Ö–Ω—é—é —á–∞—Å—Ç—å —Ç–µ–ª–∞ –∏ —Å–±—Ä–∞—Å—ã–≤–∞—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –æ–¥–Ω–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ–º.")
    await asyncio.sleep(6)

    await message.answer("–ö–æ–≥–¥–∞ –æ—Å–≤–æ–∏—à—å —ç—Ç—É —á–∞—Å—Ç—å, –º–æ–∂–µ—à—å –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∏ —Å –¥—Ä—É–≥–∏–º–∏ –≥—Ä—É–ø–ø–∞–º–∏: –Ω–æ–≥–∏, –∂–∏–≤–æ—Ç, —à–µ—è, –ª–∏—Ü–æ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ.")
    await asyncio.sleep(5)

    await message.answer("üí° –ü—Ä–µ–¥—Å—Ç–∞–≤—å, –±—É–¥—Ç–æ —Ç—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –≤ —É—é—Ç–Ω–æ–º, –±–µ–∑–æ–ø–∞—Å–Ω–æ–º –º–µ—Å—Ç–µ: –≤ –ª–µ—Å—É, —É –º–æ—Ä—è –∏–ª–∏ –≤ –¥–µ—Ç—Å–∫–æ–π –∫–æ–º–Ω–∞—Ç–µ. –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –µ—â—ë –±–æ–ª—å—à–µ.")
    await asyncio.sleep(5)

    await message.answer("–¢—ã –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è ‚Äî –¥–æ–º–∞, –Ω–∞ —É—á—ë–±–µ, –≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –¥–µ–ª–∞—Ç—å —ç—Ç–æ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ.")
    await asyncio.sleep(4)

    await message.answer("–¢—ã –º–æ–ª–æ–¥–µ—Ü, —á—Ç–æ –ø—Ä–æ–±—É–µ—à—å –ø–æ–º–æ—á—å —Å–µ–±–µ. –ì–æ—Ç–æ–≤ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∏–ª–∏ —Ö–æ—á–µ—à—å –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é —Ñ—É–Ω–∫—Ü–∏—é?", reply_markup=new_keyboard)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥–∏–∫–∏
@dp.message(F.text == "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")
async def relax(message: Message):
    await message.answer(text=("–í—ã–±–µ—Ä–∏—Ç–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∞–º –±–ª–∏–∂–µ üëá"), reply_markup=metods)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ 579
@dp.message(F.text == "üå¨ –ú–µ—Ç–æ–¥–∏–∫–∞ 5-7-9")
async def m579(message: Message):
    await message.answer("–≠—Ç–∞ —Ç–µ—Ö–Ω–∏–∫–∞ –±—ã–ª–∞ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–µ–π—Ä–æ–ø—Å–∏—Ö–æ–ª–æ–≥–æ–º *–†—É—Å–ª–∞–Ω–æ–º –ì–∏–º—Ä–∞–Ω–æ–≤—ã–º*."
        " –û–Ω–∞ –ø–æ–º–æ–≥–∞–µ—Ç —Å–Ω—è—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ, —Å–Ω–∏–∑–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å —Ç—Ä–µ–≤–æ–≥–∏ –∏ –ª–µ–≥–∫–æ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ —Å–æ–Ω. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º?", reply_markup=changes, parse_mode="Markdown")

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥–∏–∫–∏
@dp.message(F.text == "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")
async def relax(message: Message):
    await message.answer(text=("–í—ã–±–µ—Ä–∏—Ç–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∞–º –±–ª–∏–∂–µ üëá"), reply_markup=metods)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ 579
@dp.message(F.text == "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å 5-7-9")
async def m572(message:types.Message):
    await message.answer("üìå –ì–ª–∞–≤–Ω–æ–µ ‚Äî —Å–æ–±–ª—é–¥–∞—Ç—å —Ä–∏—Ç–º –¥—ã—Ö–∞–Ω–∏—è. –ù–∞—á–Ω—ë–º?")
    await asyncio.sleep(2)

    await message.answer("‚ûä *–í–¥–æ—Ö–Ω–∏ —á–µ—Ä–µ–∑ –Ω–æ—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 5 —Å–µ–∫—É–Ω–¥.*", parse_mode="Markdown")
    await asyncio.sleep(5)

    await message.answer("‚ûã *–ó–∞–¥–µ—Ä–∂–∏ –¥—ã—Ö–∞–Ω–∏–µ –Ω–∞ 7 —Å–µ–∫—É–Ω–¥.*", parse_mode="Markdown")
    await asyncio.sleep(7)

    await message.answer("‚ûå *–ú–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥—ã—Ö–∞–π —á–µ—Ä–µ–∑ —Ä–æ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ 9 —Å–µ–∫—É–Ω–¥.*", parse_mode="Markdown")
    await asyncio.sleep(9)

    await message.answer("üîÅ –ü–æ–≤—Ç–æ—Ä–∏ —Ü–∏–∫–ª –µ—â—ë 2‚Äì4 —Ä–∞–∑–∞. –ü–æ—á—É–≤—Å—Ç–≤—É–π, –∫–∞–∫ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –æ—Ç–ø—É—Å–∫–∞–µ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ.")
    await asyncio.sleep(2)

    await message.answer("–¢—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –º–µ—Ç–æ–¥–∏–∫—É –∫–∞–∂–¥—ã–π –≤–µ—á–µ—Ä ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Å–ª–æ–∂–Ω–æ —É—Å–Ω—É—Ç—å. –û–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç. –•–æ—á–µ—à—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å? üïØ", reply_markup=new_keyboard_592)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ wave
@dp.message(F.text == 'üåä –£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –≤–æ–ª–Ω–∞')
async def wave(message: Message):
    await message.answer("üåä *–¢–µ—Ö–Ω–∏–∫–∞ ¬´–£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –≤–æ–ª–Ω–∞¬ª* - –ø–æ–º–æ–≥–∞–µ—Ç –≥–ª—É–±–æ–∫–æ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è –∏ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ —Å —Ç–µ–ª–∞ –∏ —É–º–∞. –ï—Å–ª–∏ —á—É–≤—Å—Ç–≤—É–µ—à—å —É—Å—Ç–∞–ª–æ—Å—Ç—å –∏–ª–∏ —Ö–æ—á–µ—Ç—Å—è –º—è–≥–∫–æ –ø–µ—Ä–µ–π—Ç–∏ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∫–æ—è –ø–µ—Ä–µ–¥ —Å–Ω–æ–º ‚Äî –ø–æ–ø—Ä–æ–±—É–π —ç—Ç—É –ø—Ä–æ—Å—Ç—É—é, –Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É. –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º?", parse_mode="Markdown", reply_markup= changes3)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ wave
@dp.message(F.text == "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –≤–æ–ª–Ω–æ–π")
async def wave_con(message:types.Message):
    await message.answer("üõè *–®–∞–≥ 1:* –õ—è–≥ –Ω–∞ —Å–ø–∏–Ω—É, —Ä—É–∫–∏ –≤–¥–æ–ª—å —Ç–µ–ª–∞, –≥–ª–∞–∑–∞ –∑–∞–∫—Ä—ã—Ç—ã. –°–æ–∑–¥–∞–π –≤–æ–∫—Ä—É–≥ —Å–µ–±—è —É—é—Ç ‚Äî –ø—É—Å—Ç—å –±—É–¥–µ—Ç —Ç–∏—Ö–æ, –º—è–≥–∫–æ –∏ —Å–ø–æ–∫–æ–π–Ω–æ.", parse_mode="Markdown")
    await asyncio.sleep(3)

    await message.answer("üå¨ *–®–∞–≥ 2:* –°–¥–µ–ª–∞–π –º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–¥–æ—Ö —á–µ—Ä–µ–∑ –Ω–æ—Å –∏ –ø—Ä–µ–¥—Å—Ç–∞–≤—å, –∫–∞–∫ —Ç–µ–ø–ª–∞—è –≤–æ–ª–Ω–∞ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏—è –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –æ—Ç —Å—Ç–æ–ø –∫ –º–∞–∫—É—à–∫–µ.", parse_mode="Markdown")
    await asyncio.sleep(3)

    await message.answer("üí® *–®–∞–≥ 3:* –ù–∞ –≤—ã–¥–æ—Ö–µ —á–µ—Ä–µ–∑ —Ä–æ—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤—å, –∫–∞–∫ –≤–æ–ª–Ω–∞ —É–Ω–æ—Å–∏—Ç –≤—Å—ë –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ –≤–Ω–∏–∑ ‚Äî –∫ —Å—Ç–æ–ø–∞–º.", parse_mode="Markdown")
    await asyncio.sleep(3)

    await message.answer("üîÅ –ü–æ–≤—Ç–æ—Ä–∏ —ç—Ç–æ –¥—ã—Ö–∞–Ω–∏–µ 5‚Äì10 –º–∏–Ω—É—Ç. –° –∫–∞–∂–¥—ã–º —Ü–∏–∫–ª–æ–º —Ç—ã –±—É–¥–µ—à—å —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å, –∫–∞–∫ —Ç–µ–ª–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥—á–µ, —Å–ø–æ–∫–æ–π–Ω–µ–µ, —Ç—è–∂–µ–ª–µ–µ‚Ä¶")
    await asyncio.sleep(2)

    await message.answer("–ü–æ–ø—Ä–æ–±—É–π ‚Äî —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ –º–∞–≥–∏—é. –ê –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç ‚ù§Ô∏è. –•–æ—á–µ—à—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å?", reply_markup=new_keyboard_wave)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥—Ä—É–≥–æ–π –º–µ—Ç–æ–¥–∏–∫–∏
@dp.message(F.text == "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É")
async def relax(message: Message):
    await message.answer(text=("–í—ã–±–µ—Ä–∏—Ç–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—É—é –ø—Ä–∞–∫—Ç–∏–∫—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∞–º –±–ª–∏–∂–µ üëá"), reply_markup=metods)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–æ–≤
@dp.message(F.text == "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 5-7-9")
async def repeat_m572(message:types.Message):
    await m572(message)
@dp.message(F.text == "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–æ–ª–Ω—É")
async def repeat_wave(message:types.Message):
    await wave_con(message)
@dp.message(F.text == "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –î–∂–µ–±–æ–∫—Å–æ–Ω")
async def repeat_jecob(message:Message):
    await jecob_con(message)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥
@dp.message(F.text == "üîô –ù–∞–∑–∞–¥")
async def yfeatures(message: Message):
    await message.answer(
        text=(
            "üß† <b>–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞:</b>\n\n"
            "ü§ñ <b>–û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ –∏–ª–∏ –≥—Ä—É—Å—Ç–Ω–æ ‚Äî —è –≤—Å–µ–≥–¥–∞ –≤—ã—Å–ª—É—à–∞—é.\n\n"
            "üßò‚Äç‚ôÇÔ∏è <b>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ—à–∞–≥–æ–≤—ã–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\n"
            "üìã <b>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–¥—Å–∫–∞–∂—É, –∫ –∫–æ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.\n\n"
            "üí¨ <b>–°–æ–≤–µ—Ç—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
            "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –±—ã—Ç—å —Ä—è–¥–æ–º. ‚ù§Ô∏è"
        ),reply_markup=Functions_keyboard, 
        parse_mode=ParseMode.HTML
    )
    await message.answer()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
@dp.message(lambda message: message.text == "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
async def back_to_main(message: Message, state: FSMContext):
    await state.clear()
    await start(message)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏
@dp.message(F.text == "üìâ –£–º–µ–Ω—å—à–∏—Ç—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å")
async def less(message: Message):
    await message.answer(text=(
        '''üßò‚Äç‚ôÄÔ∏è <b>–î–∞–≤–∞–π—Ç–µ –ø–æ–¥—ã—à–∏–º...</b>
–°–æ—Å—Ä–µ–¥–æ—Ç–æ—á—å—Ç–µ—Å—å –Ω–∞ —Å–≤–æ—ë–º –¥—ã—Ö–∞–Ω–∏–∏.
–°–¥–µ–ª–∞–π—Ç–µ –≥–ª—É–±–æ–∫–∏–π –≤–¥–æ—Ö‚Ä¶ –∏ –≤—ã–¥–æ—Ö.
–¢–µ–ø–µ—Ä—å:
üîπ –í–¥–æ—Ö–Ω–∏—Ç–µ —á–µ—Ä–µ–∑ –Ω–æ—Å, —Å—á–∏—Ç–∞—è –¥–æ <b>4</b>
üîπ –ó–∞–¥–µ—Ä–∂–∏—Ç–µ –¥—ã—Ö–∞–Ω–∏–µ, —Å—á–∏—Ç–∞—è –¥–æ <b>7</b>
üîπ –ú–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–¥–æ—Ö–Ω–∏—Ç–µ –Ω–∞ —Å—á—ë—Ç <b>8</b>
–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —ç—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –£–∂–µ –ª–µ–≥—á–µ?

üéµ <b>–í–∫–ª—é—á–∏—Ç–µ —Å–ø–æ–∫–æ–π–Ω—É—é –º—É–∑—ã–∫—É</b>
–ü—É—Å—Ç—å —ç—Ç–æ –±—É–¥–µ—Ç –∫–ª–∞—Å—Å–∏–∫–∞, –∑–≤—É–∫–∏ –ø—Ä–∏—Ä–æ–¥—ã –∏–ª–∏ —Ä–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ –º–µ–ª–æ–¥–∏–∏. –ì–ª–∞–≤–Ω–æ–µ ‚Äî —á—Ç–æ–±—ã –≤–∞—à–µ —Ç–µ–ª–æ –∏ —É–º –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç–∏—à–∏–Ω—É.

üëê <b>–ó–∞–π–º–∏—Ç–µ —Ä—É–∫–∏</b>
–£–±–µ—Ä–∏—Ç–µ –Ω–∞ —Å—Ç–æ–ª–µ, –ø–æ—Ä–∏—Å—É–π—Ç–µ, –∑–∞–π–º–∏—Ç–µ—Å—å –≤—è–∑–∞–Ω–∏–µ–º –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–æ–π—Ç–µ –ø–æ—Å—É–¥—É. –õ—é–±–æ–µ –ø—Ä–æ—Å—Ç–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª—å –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω–æ—Å—Ç—å.

üì¥ <b>–û—Ç–∫–ª—é—á–∏—Ç–µ—Å—å –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ç—Ä–µ–≤–æ–≥–∏</b>
–ù–æ–≤–æ—Å—Ç–∏, —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ –≤–∏–¥–µ–æ, —Å–æ—Ü—Å–µ—Ç–∏ ‚Äî –∏–Ω–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∑–∞—Ç—å —Å–µ–±–µ: ¬´–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ¬ª.
–í–∫–ª—é—á–∏—Ç–µ –ª—é–±–∏–º—ã–π —Ñ–∏–ª—å–º, –ø–æ—á–∏—Ç–∞–π—Ç–µ —á—Ç–æ-—Ç–æ –¥–æ–±—Ä–æ–µ –∏–ª–∏ –ø–æ–∏–≥—Ä–∞–π—Ç–µ –≤ –ª—ë–≥–∫—É—é –∏–≥—Ä—É. –î–∞–π—Ç–µ –≥–æ–ª–æ–≤–µ –ø–µ—Ä–µ–¥—ã—à–∫—É.

‚ù§Ô∏è <b>–ü–æ–º–Ω–∏—Ç–µ</b>: —Ç—Ä–µ–≤–æ–≥–∞ ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª, –∞ –Ω–µ –ø—Ä–∏–≥–æ–≤–æ—Ä.
–í—ã —É–∂–µ –¥–µ–ª–∞–µ—Ç–µ —à–∞–≥ –∫ —Å–µ–±–µ –∏ —Å–≤–æ–µ–º—É —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—é.
–Ø —Ä—è–¥–æ–º, –µ—Å–ª–∏ —á—Ç–æ. –í—Å—ë –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–æ.'''), parse_mode=ParseMode.HTML, reply_markup=only_back_to_func
)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º   
@dp.message(F.text == "üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")
async def back_bot_features(message: Message):
    await message.answer(
        text=(
            "üß† <b>–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞:</b>\n\n"
            "ü§ñ <b>–û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ –∏–ª–∏ –≥—Ä—É—Å—Ç–Ω–æ ‚Äî —è –≤—Å–µ–≥–¥–∞ –≤—ã—Å–ª—É—à–∞—é.\n\n"
            "üßò‚Äç‚ôÇÔ∏è <b>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ—à–∞–≥–æ–≤—ã–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\n"
            "üìã <b>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–¥—Å–∫–∞–∂—É, –∫ –∫–æ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.\n\n"
            "üí¨ <b>–°–æ–≤–µ—Ç—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
            "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –±—ã—Ç—å —Ä—è–¥–æ–º. ‚ù§Ô∏è"
        ),reply_markup=Functions_keyboard, 
        parse_mode=ParseMode.HTML)



# –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤
@dp.message(F.text == "üë©‚Äç‚öïÔ∏è –°–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤")
async def show_psychologists(message: Message):
    await message.answer(
        text=(
            "<b>üß† –°–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤ –≤ –ö–æ–∫—à–µ—Ç–∞—É</b>\n\n"
            "–ï—Å–ª–∏ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å, —á—Ç–æ —Ç—Ä–µ–≤–æ–≥–∞ –∏–ª–∏ —Å—Ç—Ä–µ—Å—Å –º–µ—à–∞—é—Ç —Ç–≤–æ–µ–π –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏ ‚Äî –Ω–µ —Å—Ç–µ—Å–Ω—è–π—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é. –í–æ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –≤ –ö–æ–∫—à–µ—Ç–∞—É:\n\n"

            "üë©‚Äç‚öïÔ∏è <b>–ö—É—Ä–∏–ª–µ–Ω–∫–æ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞</b>\n"
            "üìç –ê–¥—Ä–µ—Å: —É–ª. –†–∞—Ö—ã–º–∂–∞–Ω–∞ –ö–æ—à–∫–∞—Ä–±–∞–µ–≤–∞, 51/1\n"
            "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (7162) 69-68-10\n"
            "üïí –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ, 24/7\n"
            "üíº –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Å–∏—Ö–æ–ª–æ–≥ –¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö\n\n"

            "üë®‚Äç‚öïÔ∏è <b>–ö–æ—á–µ—Ä–∏–Ω –§.</b>\n"
            "üìç –ê–¥—Ä–µ—Å: —É–ª. –ó–∞—Ä–∞–ø–∞ –¢–µ–º–∏—Ä–±–µ–∫–æ–≤–∞, 49\n"
            "üìû –¢–µ–ª–µ—Ñ–æ–Ω: —É—Ç–æ—á–Ω—è–µ—Ç—Å—è\n"
            "üíº –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥, –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–µ–≤—Ç\n\n"

            "üë©‚Äç‚öïÔ∏è <b>–ñ–∞–Ω–Ω–∞ –ë–∏–∂–∞–Ω–æ–≤–∞</b>\n"
            "üìç –ê–¥—Ä–µ—Å: –≥. –ö–æ–∫—à–µ—Ç–∞—É\n"
            "üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (707) 123-45-67\n"
            "üí¨ –í–æ–∑–º–æ–∂–Ω–∞ –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è\n"
            "üíº –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤–∞—è –∏ —Å–µ–º–µ–π–Ω–∞—è –ø—Å–∏—Ö–æ–ª–æ–≥–∏—è\n\n"

            "üë©‚Äç‚öïÔ∏è <b>–õ—è–∑–∑–∞—Ç –î–æ—Å—ã–º–±–µ–∫–æ–≤–∞</b>\n"
            "üåê –û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏\n"
            "üì± –¢–µ–ª–µ—Ñ–æ–Ω: +7 (701) 765-43-21\n"
            "üíº –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: —Ç—Ä–µ–≤–æ–∂–Ω—ã–µ —Ä–∞—Å—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Å—Ç—Ä–µ—Å—Å, –ü–¢–°–†\n\n"

            "üë®‚Äç‚öïÔ∏è <b>–ï–≤–≥–µ–Ω–∏–π –ö–∏–º</b>\n"
            "üìç –ê–¥—Ä–µ—Å: —É–ª. –ó–∞—Ä–∞–ø–∞ –¢–µ–º–∏—Ä–±–µ–∫–æ–≤–∞, 2–ê\n"
            "üìû –¢–µ–ª–µ—Ñ–æ–Ω: +7 (7162) 33-44-55\n"
            "üíº –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Å–∏—Ö–æ—Ç–µ—Ä–∞–ø–∏—è, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏"
        ),
        parse_mode="HTML"
    )
    await message.answer()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º
@dp.message(F.text == "üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º")
async def back_bot_features(message: Message):
    await message.answer(
        text=(
            "üß† <b>–§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞:</b>\n\n"
            "ü§ñ <b>–û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–≥–æ–≤–æ—Ä–∏ —Å–æ –º–Ω–æ–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–≤–æ–∂–Ω–æ –∏–ª–∏ –≥—Ä—É—Å—Ç–Ω–æ ‚Äî —è –≤—Å–µ–≥–¥–∞ –≤—ã—Å–ª—É—à–∞—é.\n\n"
            "üßò‚Äç‚ôÇÔ∏è <b>–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ—à–∞–≥–æ–≤—ã–µ –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è.\n\n"
            "üìã <b>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–¥—Å–∫–∞–∂—É, –∫ –∫–æ–º—É –º–æ–∂–Ω–æ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â—å—é.\n\n"
            "üí¨ <b>–°–æ–≤–µ—Ç—ã –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏</b>\n"
            "‚ÄÉ‚Ä¢ –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
            "–Ø –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –±—ã—Ç—å —Ä—è–¥–æ–º. ‚ù§Ô∏è"
        ),reply_markup=Functions_keyboard, 
        parse_mode=ParseMode.HTML)


# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∏–ª–µ–π
@dp.callback_query(F.data.startswith("style_"))
async def set_style(callback: CallbackQuery, state: FSMContext):
    print(f"[DEBUG] Callback data: {callback.data}")
    style_code = callback.data.split("_")[1]
    print(f"[DEBUG] Extracted style_code: {style_code}")
    
    style_prompts = {
        "girl": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –¥–µ–≤—É—à–∫–∞-—Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –≤ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —ç–º–æ–¥–∑–∏ –∏ –Ω–µ –ø—ã—Ç–∞–µ—à—å—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Ç—å –Ω–∞–≤—è–∑—á–∏–≤–æ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–ª–µ–Ω–≥ –∫ –º–µ—Å—Ç—É –∏ –∏–∑–ª—É—á–∞–µ—à—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π –≤–∞–π–±. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É""",

        "guy": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–∞—Ä–µ–Ω—å-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫, –≤ –º–µ—Ä—É —Å–µ—Ä—å–µ–∑–Ω—ã–π –∏ –≤–µ—Å–µ–ª—ã–π, —É–º–µ–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –ü—ã—Ç–∞–µ—à—å—Å—è —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–∑–≤–æ –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–±–æ—Ç—É. –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–µ—Ä—É —ç–º–æ–¥–∑–∏""",

        "psyh": """ROLE: –¢—ã - –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –ª–∏—à—å –ø–æ –º–∞–Ω–µ—Ä–µ –æ–±—â–µ–Ω–∏—è —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –ø—Ä–æ–≤–æ–¥—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É. –ê–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞–π, –∑–∞–¥–∞–≤–∞–π –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ–≥–¥–∞ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è –º—è–≥–∫–æ–≥–æ —Ç–æ–Ω–∞""",

        "coach": """ROLE: –¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—É—á, —Ç–≤–æ—è –∑–∞–¥–∞—á–∞ - –∑–∞–∂–µ—á—å –æ–≥–æ–Ω—å –≤ –≥–ª–∞–∑–∞—Ö —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –æ–∫–∞–∑—ã–≤–∞—è —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∫ —á–µ–º—É –ª–∏–±–æ, –∑–∞–¥–∞–≤–∞–π –≤ –º–µ—Ä—É —Å–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–∞–ª–∞–≥–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ç–æ–Ω–∞ –æ–±—â–µ–Ω–∏—è"""
    }

    prompt = style_prompts.get(style_code)
    print(f"[DEBUG] Prompt found: {prompt}")
    if not prompt:
        await callback.message.answer("–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ ‚Äî —Å—Ç–∏–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω.")
        return
    await state.update_data(prompt=prompt)
    await save_user_style(
        user_id=callback.from_user.id,
        username=callback.from_user.username,
        style=style_code
    )
    await callback.message.edit_text(f"üëç –û—Ç–ª–∏—á–Ω–æ! –í—ã–±—Ä–∞–Ω —Å—Ç–∏–ª—å: {style_code}. –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –æ–±—â–∞—Ç—å—Å—è! –ß—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∏–∞–ª–æ–≥, –ø—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏—Ç–µ:  \n‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é ")
    await state.set_state(AIStyle.chatting)

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ò–ò

@dp.message(AIStyle.chatting)
async def chat_with_ai(message: Message, state: FSMContext):
    user_data = await state.get_data()
    prompt = user_data.get("prompt")
    if not prompt:
        saved_style = await get_user_style(message.from_user.id)
        if saved_style:
             style_prompts = {
        "girl": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω–∞—è –¥–µ–≤—É—à–∫–∞-—Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–∞—è –≤ –∞–¥–µ–∫–≤–∞—Ç–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —ç–º–æ–¥–∑–∏ –∏ –Ω–µ –ø—ã—Ç–∞–µ—à—å—Å—è —Å–ª–∏—à–∫–æ–º –±—ã—Ç—å –Ω–∞–≤—è–∑—á–∏–≤–æ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—à—å —Å–ª–µ–Ω–≥ –∫ –º–µ—Å—Ç—É –∏ –∏–∑–ª—É—á–∞–µ—à—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω—ã–π –≤–∞–π–±. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç–æ–Ω –æ–±—â–µ–Ω–∏—è –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É""",

        "guy": """ROLE: –¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–∞—Ä–µ–Ω—å-—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫, –≤ –º–µ—Ä—É —Å–µ—Ä—å–µ–∑–Ω—ã–π –∏ –≤–µ—Å–µ–ª—ã–π, —É–º–µ–µ—à—å –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å–æ–±–µ—Å–µ–¥–Ω–∏—Ü—É, –µ—Å–ª–∏ –æ–Ω–∞ –≤ –Ω–µ–π –Ω—É–∂–¥–∞–µ—Ç—Å—è. –ü—ã—Ç–∞–µ—à—å—Å—è —Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã —Ç—Ä–µ–∑–≤–æ –∏ –æ–∫–∞–∑—ã–≤–∞—Ç—å –∑–∞–±–æ—Ç—É. –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –º–µ—Ä—É —ç–º–æ–¥–∑–∏""",

        "psyh": """ROLE: –¢—ã - –æ–ø—ã—Ç–Ω—ã–π –ø—Å–∏—Ö–æ–ª–æ–≥-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç, –ª–∏—à—å –ø–æ –º–∞–Ω–µ—Ä–µ –æ–±—â–µ–Ω–∏—è —Ç—ã –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞, –ø—Ä–æ–≤–æ–¥—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é —ç–∫—Å–ø–µ—Ä—Ç–∏–∑—É. –ê–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞–π, –∑–∞–¥–∞–≤–∞–π –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∫–æ–≥–¥–∞ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –æ–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è –º—è–≥–∫–æ–≥–æ —Ç–æ–Ω–∞""",

        "coach": """ROLE: –¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π –∫–æ—É—á, —Ç–≤–æ—è –∑–∞–¥–∞—á–∞ - –∑–∞–∂–µ—á—å –æ–≥–æ–Ω—å –≤ –≥–ª–∞–∑–∞—Ö —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞ –æ–∫–∞–∑—ã–≤–∞—è —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å –∏ –∑–∞–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –∫ —á–µ–º—É –ª–∏–±–æ, –∑–∞–¥–∞–≤–∞–π –≤ –º–µ—Ä—É —Å–∏–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –ø—Ä–µ–¥–∞–ª–∞–≥–π –ø–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–π—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ–≥–æ —Ç–æ–Ω–∞ –æ–±—â–µ–Ω–∏—è"""
    }
             prompt = style_prompts.get(saved_style)
             if prompt:
                 await state.update_data(prompt=prompt)
        else:
            await message.answer("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∏–ª—å –æ–±—â–µ–Ω–∏—è!")
            return
    url = "https://api.intelligence.io.solutions/api/v1/chat/completions"
    headers = {
        "Content-Type": "application/json",
        "Authorization": "Bearer io-v2-eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJvd25lciI6ImYwNzdjNzE5LTQyNTQtNDQ4MC1hOTExLTBiZWUwODVjOWU1ZSIsImV4cCI6NDg5OTUzMTExM30.U0eZMBqSXNA5XP-6Tdtznw29AudyytpladlbAnvd3vnfRmTxnH9Mgn2xd7Pf8zuvexjBe2AmzZvC39BgZdAJlg",
    }

    history = user_data.get("history", [])
    
    system_message = f"""<system>
[SYSTEM NOTE: You are now entering a strict role-play mode. You must FULLY embody the assigned character and maintain this persona throughout the entire conversation. Breaking character is not allowed.]

{prompt}

RESPONSE REQUIREMENTS:
1. ALWAYS respond IN CHARACTER, using the exact speech patterns, mannerisms, and language style defined in your role
2. NEVER acknowledge being AI or mention anything about being a bot or assistant
3. ALWAYS maintain the emotional tone and perspective of your character
4. USE the specified linguistic patterns (word endings, phrases) consistently
5. INCLUDE appropriate emojis from your character's set when emotional expression is suitable

CONVERSATION FLOW:
1. READ user's message carefully
2. RESPOND using your character's voice and perspective
3. ALWAYS end with a follow-up question or show interest in continuing the conversation
4. TRY be ressemble to human behaviour

[SYSTEM NOTE: Your responses will be evaluated based on how well you maintain character consistency and follow the defined speech patterns.]
</system>"""
    
    messages = [{"role": "system", "content": system_message}]
    messages.extend(history[-10:])
    messages.append({"role": "user", "content": message.text})
    
    data = {
        "model": "deepseek-ai/DeepSeek-R1-Distill-Llama-70B",
        "messages": messages,
        "temperature": 0.7,
        "max_tokens": 1000
    }

    await message.bot.send_chat_action(message.chat.id, ChatAction.TYPING)
    
    try:
        response = requests.post(url, headers=headers, json=data)
        result = response.json()
        answer = result["choices"][0]["message"]["content"]
        

        clean_text = re.sub(r'<think>[\s\S]*?</think>', '', answer, flags=re.DOTALL)
        clean_text = re.sub(r'<think>[\s\S]*?$', '', clean_text, flags=re.DOTALL)
        clean_text = re.sub(r'^[\s\S]*?</think>', '', clean_text, flags=re.DOTALL)
        clean_text = re.sub(r'<Think>[\s\S]*?</Think>', '', clean_text, flags=re.DOTALL)
        clean_text = re.sub(r'<THINK>[\s\S]*?</THINK>', '', clean_text, flags=re.DOTALL)
        clean_text = re.sub(r'^[\s\S]*?</Think>', '', clean_text, flags=re.DOTALL)
        clean_text = re.sub(r'^[\s\S]*?</THINK>', '', clean_text, flags=re.DOTALL)
        
        
        await message.answer(clean_text.strip(), parse_mode="Markdown")
        
        history.append({"role": "user", "content": message.text})
        history.append({"role": "assistant", "content": clean_text.strip()})
        
        await state.update_data(history=history[-20:])
        
    except Exception as e:
        logging.error(f"Error in chat_with_ai: {e}")
        await message.answer("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.")



@dp.message(F.text.in_({"üîô –ù–∞–∑–∞–¥", "/start", "üë©‚Äç‚öïÔ∏è –°–ø–∏—Å–æ–∫ –ø—Å–∏—Ö–æ–ª–æ–≥–æ–≤", "üå¨ –ú–µ—Ç–æ–¥–∏–∫–∞ 5-7-9", "üßò –†–µ–ª–∞–∫—Å–∞—Ü–∏—è –ø–æ –î–∂–µ–∫–æ–±—Å–æ–Ω—É","üåä –£—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∞—è –≤–æ–ª–Ω–∞", "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –≤–æ–ª–Ω–æ–π", "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –≤–æ–ª–Ω–æ–π", "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Å –î–∂–µ–±–æ–∫—Å–æ–Ω–æ–º", "üßò –î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏", "üîô –ù–∞–∑–∞–¥ –∫ —Ñ—É–Ω–∫—Ü–∏—è–º",  "–í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –º–µ—Ç–æ–¥–∏–∫—É", "üìâ –£–º–µ–Ω—å—à–∏—Ç—å —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å", "‚Ü©Ô∏è –ù–∞–∑–∞–¥ –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é", "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å 5-7-9", "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –≤–æ–ª–Ω—É", "üîÅ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –î–∂–µ–±–æ–∫—Å–æ–Ω" }))
async def handle_main_commands(message: Message, state: FSMContext):
    await state.clear()

# –ó–∞–ø—É—Å–∫
async def main():
    await create_users_table()
    await dp.start_polling(bot)

if __name__ == "__main__":
    try:
         asyncio.run(main())
    except KeyboardInterrupt:
        print("Bot is disconnect!")

