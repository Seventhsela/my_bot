import asyncio
import asyncpg
import random
import os
from aiogram import Bot

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = os.getenv('BOT_TOKEN')

# –°—Å—ã–ª–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL = os.getenv('DATABASE_URL')

# –°–ø–∏—Å–æ–∫ –≤–æ–∑–º–æ–∂–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
REMINDER_MESSAGES = [
    "–ü—Ä–∏–≤–µ—Ç! –ù–µ —Ö–æ—á–µ—à—å –Ω–µ–º–Ω–æ–≥–æ –ø–æ–æ–±—â–∞—Ç—å—Å—è —Å–æ –º–Ω–æ–π? –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏—é 'üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º'", 
    "–Ø —Ç—É—Ç —Å–∫—É—á–∞—é... –ó–∞–≥–ª—è–Ω–∏ –∫–æ –º–Ω–µ!",
    "–≠–π, –∫–∞–∫ —Ç–≤–æ–∏ –¥–µ–ª–∞? –î–∞–≤–∞–π –ø–æ–±–æ–ª—Ç–∞–µ–º! –ü—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏—é 'üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º'",
    "–Ø –≤—Å–µ–≥–¥–∞ –Ω–∞ —Å–≤—è–∑–∏, –µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å :)",
    "–ü–æ–º–Ω–∏—à—å –ø—Ä–æ –º–µ–Ω—è? –Ø –≤—Å—ë –µ—â—ë –∑–¥–µ—Å—å, –∂–¥—É —Ç–≤–æ–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è!",
    "–ß—Ç–æ-—Ç–æ —Ç–µ–±—è –Ω–µ –≤–∏–¥–Ω–æ, –≤—Å–µ —Ö–æ—Ä–æ—à–æ?",
    "–†–∞—Å—Å–∫–∞–∂–∏ –∫–∞–∫ –ø—Ä–æ—à–µ–ª —Ç–≤–æ–π –¥–µ–Ω—å, –ø—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ —Ñ—É–Ω–∫—Ü–∏—é 'üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º'",
    "–Ø —á—É–≤—Å—Ç–≤—É—é —Ç–µ–±–µ –Ω—É–∂–Ω–∞ –º–æ—Ç–∏–≤–æ—Ü–∏–æ–Ω–Ω–∞—è —Ä–µ—á—å –æ—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞. –ù–∞—á–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º, –ø—Ä–æ—Å—Ç–æ –≤—ã–±—Ä–∞–≤ —Ñ—É–Ω–∫—Ü–∏—é 'üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º'",
    "–í–æ–∑–º–æ–∂–Ω–æ —Ç—ã –Ω—É–∂–¥–∞–µ—à—å—Å—è –≤ –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ü–∏–∏ —É –ø—Å–∏—Ö–æ–ª–æ–≥–∞. –ù–∞—á–Ω–∏ —Ä–∞–∑–≥–æ–≤–æ—Ä —Å –ò–ò-–ø—Å–∏—Ö–æ–ª–æ–≥–æ–º, –ø—Ä–æ—Å—Ç–æ –≤—ã–±—Ä–∞–≤ —Ñ—É–Ω–∫—Ü–∏—é 'üß† –û–±—â–µ–Ω–∏–µ —Å –ò–ò-–∫–æ–º–ø–∞–Ω—å–æ–Ω–æ–º'",
    "–ù–µ –∑–∞–±—ã–≤–∞–π –≤—ã–ø–æ–ª–Ω—è—Ç—å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏! –Ø —Ç–µ–±–µ —Å —ç—Ç–∏–º –ø–æ–º–æ–≥—É!",
    "–£–∑–Ω–∞–π —É –º–µ–Ω—è –æ —Å–æ–≤–µ—Ç–∞—Ö –ø–æ —Å–Ω–∏–∂–µ–Ω–∏—é —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏",
    "–ï—Å–ª–∏ –∏—â–µ—à—å –ø—Å–∏—Ö–æ–ª–æ–≥–∞ –≤ –ö–æ–∫—à–µ—Ç–∞—É, —è –∑–¥–µ—Å—å!"
]

async def send_reminders():
    bot = Bot(token=BOT_TOKEN)

    conn = await asyncpg.connect(DATABASE_URL)
    users = await conn.fetch("SELECT user_id FROM users")

    for user in users:
        user_id = user['user_id']
        message = random.choice(REMINDER_MESSAGES)  
        try:
            await bot.send_message(user_id, message)
        except Exception as e:
            print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å {user_id}: {e}")

    await conn.close()
    await bot.session.close()

asyncio.run(send_reminders())
